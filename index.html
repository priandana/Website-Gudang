// ===== ANNOUNCEMENT MODAL =====
const LS_ANN_HIDE = "praktis_announcement_hide_v1";

const annBackdrop = document.getElementById("annBackdrop");
const annClose = document.getElementById("annClose");
const annLater = document.getElementById("annLater");
const annOk = document.getElementById("annOk");
const annDontShow = document.getElementById("annDontShow");

function openAnn(){
  if (!annBackdrop) return;
  annBackdrop.classList.add("show");
  annBackdrop.setAttribute("aria-hidden", "false");
  document.body.style.overflow = "hidden";
}
function closeAnn(){
  if (!annBackdrop) return;
  annBackdrop.classList.remove("show");
  annBackdrop.setAttribute("aria-hidden", "true");
  document.body.style.overflow = "";
}

function markAnnPreference(){
  if (annDontShow?.checked) localStorage.setItem(LS_ANN_HIDE, "1");
}

// show modal on first load (if not hidden)
window.addEventListener("load", () => {
  if (localStorage.getItem(LS_ANN_HIDE) !== "1") {
    setTimeout(openAnn, 450); // biar transisi halus setelah preloader
  }
});

annClose?.addEventListener("click", () => { markAnnPreference(); closeAnn(); });
annLater?.addEventListener("click", () => { markAnnPreference(); closeAnn(); showToast("Oke", "Pengumuman ditutup.", "ðŸ“¢"); });
annOk?.addEventListener("click", () => { markAnnPreference(); closeAnn(); showToast("Sip!", "Terima kasih, sudah dibaca.", "âœ…"); });

// click outside to close
annBackdrop?.addEventListener("click", (e) => {
  if (e.target === annBackdrop) {
    markAnnPreference();
    closeAnn();
  }
});

// esc to close
document.addEventListener("keydown", (e) => {
  if (e.key === "Escape" && annBackdrop?.classList.contains("show")) {
    markAnnPreference();
    closeAnn();
  }
});
